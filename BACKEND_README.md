# C++ Backend Setup Instructions

This guide will help you build and run the C++ backend server for the Generative Music Engine.

## Prerequisites

- **CMake** (version 3.14 or higher)
- **C++17 compatible compiler** (MSVC, GCC, or Clang)
- **Git** (for fetching dependencies)

### Windows

1. Install **CMake** from [cmake.org](https://cmake.org/download/)
2. Install **Visual Studio** with C++ development tools (or use **MinGW**)

### macOS

```bash
brew install cmake
```

### Linux

```bash
sudo apt-get update
sudo apt-get install cmake build-essential
```

## Building the Backend

1. **Create a build directory:**
   ```bash
   mkdir build
   cd build
   ```

2. **Configure the project:**
   ```bash
   cmake ..
   ```
   
   This will automatically download:
   - Crow (v1.0+5) - header-only web framework
   - nlohmann/json (v3.11.2) - header-only JSON library
   - ASIO (asio-1-28-0) - header-only networking library

3. **Build the executable:**
   ```bash
   cmake --build .
   ```
   
   On Windows with Visual Studio:
   ```bash
   cmake --build . --config Release
   ```

4. **The executable will be created:**
   - Windows: `build/Release/code-notes-synth-backend.exe` (or `Debug/` for Debug builds)
   - macOS/Linux: `build/code-notes-synth-backend`

## Running the Backend

1. **Start the server:**
   
   Windows:
   ```bash
   .\code-notes-synth-backend.exe
   ```
   
   macOS/Linux:
   ```bash
   ./code-notes-synth-backend
   ```

2. **The server will start on `http://localhost:8080`**

   You should see output like:
   ```
   (2024-01-01 12:00:00) [INFO    ] Crow/1.0+5 server is running, 1 workers
   (2024-01-01 12:00:00) [INFO    ] Server bound to 0.0.0.0:8080
   ```

## Testing the API

You can test the API endpoint using curl:

```bash
curl http://localhost:8080/api/generate
```

Or open in your browser:
```
http://localhost:8080/api/generate
```

Expected response:
```json
{
  "notes": [
    { "note": "C4", "time": 0.0, "duration": "8n" },
    { "note": "E4", "time": 0.5, "duration": "8n" },
    { "note": "D4", "time": 1.0, "duration": "8n" },
    ...
  ]
}
```

## Connecting the Frontend

1. **Make sure the backend is running** on `http://localhost:8080`

2. **Start your frontend** (if not already running):
   ```bash
   npm run dev
   # or
   yarn dev
   ```

3. **Click "Generate"** in the frontend - it will automatically call the C++ backend API!

   - If the backend is running: Patterns will be generated by the C++ backend
   - If the backend is not running: The frontend will fall back to client-side generation

## Troubleshooting

### Build Errors

**Error: Could not find ASIO**
- Make sure you have internet access (CMake needs to download dependencies)
- Try deleting the `build` folder and rebuilding

**Error: C++17 not supported**
- Update your compiler (Visual Studio 2017+, GCC 7+, Clang 5+)

**Windows: Link errors with ws2_32**
- Make sure you're using Visual Studio or MinGW with proper Windows SDK

### Runtime Errors

**Port 8080 already in use**
- Stop any other service using port 8080
- Or modify `main.cpp` to use a different port

**CORS errors in browser**
- The backend includes CORS headers for `http://localhost:3000`
- Make sure your frontend is running on that port

## Project Structure

```
code-notes-synth/
â”œâ”€â”€ main.cpp              # C++ server code
â”œâ”€â”€ CMakeLists.txt        # Build configuration
â””â”€â”€ build/               # Build directory (created by you)
    â””â”€â”€ code-notes-synth-backend.exe  # Built executable
```

## Next Steps

- The backend generates patterns with 10-15 notes
- All dependencies are header-only (no installation needed)
- The server runs on port 8080 with CORS enabled for the frontend

Enjoy your C++ backend! ðŸŽµ

